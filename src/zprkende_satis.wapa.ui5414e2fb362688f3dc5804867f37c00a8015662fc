                                                                                                                                                                                                                                                               
sap.ui.define(                                                                                                                                                                                                                                                 
  [                                                                                                                                                                                                                                                            
    "sap/ui/core/mvc/Controller",                                                                                                                                                                                                                              
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    "sap/ui/model/resource/ResourceModel",                                                                                                                                                                                                                     
    "sap/m/MessageToast",                                                                                                                                                                                                                                      
    "sap/m/MessageBox",                                                                                                                                                                                                                                        
    "test/model/formatter",                                                                                                                                                                                                                                    
  ],                                                                                                                                                                                                                                                           
  /**                                                                                                                                                                                                                                                          
   * @param {typeof sap.ui.core.mvc.Controller} Controller                                                                                                                                                                                                     
   */                                                                                                                                                                                                                                                          
  function (Controller, JSONModel, ResourceModel, MessageToast, MessageBox, formatter) {                                                                                                                                                                       
    "use strict";                                                                                                                                                                                                                                              
    var totalList;                                                                                                                                                                                                                                             
    var bagliProductMatnr;                                                                                                                                                                                                                                     
    var oScanResultText;                                                                                                                                                                                                                                       
    var oBagliProductList = [];                                                                                                                                                                                                                                
    var oModelTreeProducts;                                                                                                                                                                                                                                    
    var iCurrent;                                                                                                                                                                                                                                              
    var adet = 1;                                                                                                                                                                                                                                              
    var selectedData = [];                                                                                                                                                                                                                                     
   let treeItems = [];                                                                                                                                                                                                                                         
   var mainTable = [];                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
    return Controller.extend("test.controller.View1", {                                                                                                                                                                                                        
      onInit: function () {                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                 
        this._oCurrentRequest = null;                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
      const i18nModel = new ResourceModel({                                                                                                                                                                                                                    
        bundleName: "test.i18n.i18n"                                                                                                                                                                                                                           
      });                                                                                                                                                                                                                                                      
      this.getView().setModel(i18nModel, "i18n");                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
      var oRouter = sap.ui.core.UIComponent.getRouterFor(this);                                                                                                                                                                                                
      oRouter.getRoute("RouteView1").attachMatched(this._onRouteMatched, this);                                                                                                                                                                                
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                           
      var oModel = new JSONModel();                                                                                                                                                                                                                            
      var oModel2 = new JSONModel();                                                                                                                                                                                                                           
      this.getView().setModel(oModel, "SelectedItems");                                                                                                                                                                                                        
      this.getView().setModel(oModel2, "BagliItems");                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
      this.oView = this.getView();                                                                                                                                                                                                                             
      this.oButton = this.byId("BadgedButton");                                                                                                                                                                                                                
      this.getOwnerComponent().getModel("AddBasket").setProperty("/sepet", {                                                                                                                                                                                   
        sepet: selectedData});                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
      var oTable = this.getView().byId("treeTable");                                                                                                                                                                                                           
      oTable.setVisibleRowCount(16);                                                                                                                                                                                                                           
      this.getView().setBusy(true);                                                                                                                                                                                                                            
      this.getOwnerComponent()                                                                                                                                                                                                                                 
        .getModel()                                                                                                                                                                                                                                            
        .read("/treeSet", {                                                                                                                                                                                                                                    
        success: function (oData, oResponse) {                                                                                                                                                                                                                 
          this.getView().setBusy(true);                                                                                                                                                                                                                        
          var oItems = oData.results;                                                                                                                                                                                                                          
          treeItems.push(oItems);                                                                                                                                                                                                                              
          totalList = oData.results;                                                                                                                                                                                                                           
          var oHLevel0Table = [];                                                                                                                                                                                                                              
          var oHLevel1Table = [];                                                                                                                                                                                                                              
          var oHLevel2Table = [];                                                                                                                                                                                                                              
          var oHLevel3Table = [];                                                                                                                                                                                                                              
          var oListItem0 = [];                                                                                                                                                                                                                                 
          var oListItem1 = [];                                                                                                                                                                                                                                 
          var oListItem2 = [];                                                                                                                                                                                                                                 
          var oListItem3 = [];                                                                                                                                                                                                                                 
          var oChild0 = [];                                                                                                                                                                                                                                    
          var oChild1 = [];                                                                                                                                                                                                                                    
          var oChild2 = [];                                                                                                                                                                                                                                    
          var oChild3 = [];                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
          // Tabloyu 4 tabloya childlar bos olacak sekilde bolduk:                                                                                                                                                                                             
          for (var i = 0; i < oItems.length; i++) {                                                                                                                                                                                                            
          switch (oItems[i].HLevel) {                                                                                                                                                                                                                          
            case 0:                                                                                                                                                                                                                                            
            oListItem0 = {                                                                                                                                                                                                                                     
              Description: oItems[i].Aciklama,                                                                                                                                                                                                                 
              Drillstate: oItems[i].Status,                                                                                                                                                                                                                    
              HierarchyLevel: oItems[i].HLevel,                                                                                                                                                                                                                
              NodeID: oItems[i].NodeId,                                                                                                                                                                                                                        
              ParentNodeID: oItems[i].PnodeId,                                                                                                                                                                                                                 
              remItems: oItems[i],                                                                                                                                                                                                                             
              children: oChild0,                                                                                                                                                                                                                               
            };                                                                                                                                                                                                                                                 
            oHLevel0Table.push({ oListItem0 });                                                                                                                                                                                                                
            break;                                                                                                                                                                                                                                             
            case 1:                                                                                                                                                                                                                                            
            oListItem1 = {                                                                                                                                                                                                                                     
              Description: oItems[i].Aciklama,                                                                                                                                                                                                                 
              Drillstate: oItems[i].Status,                                                                                                                                                                                                                    
              HierarchyLevel: oItems[i].HLevel,                                                                                                                                                                                                                
              NodeID: oItems[i].NodeId,                                                                                                                                                                                                                        
              ParentNodeID: oItems[i].PnodeId,                                                                                                                                                                                                                 
              remItems: oItems[i],                                                                                                                                                                                                                             
              children: oChild1,                                                                                                                                                                                                                               
            };                                                                                                                                                                                                                                                 
            oHLevel1Table.push({ oListItem1 });                                                                                                                                                                                                                
            break;                                                                                                                                                                                                                                             
            case 2:                                                                                                                                                                                                                                            
            oListItem2 = {                                                                                                                                                                                                                                     
              Description: oItems[i].Aciklama,                                                                                                                                                                                                                 
              Drillstate: oItems[i].Status,                                                                                                                                                                                                                    
              HierarchyLevel: oItems[i].HLevel,                                                                                                                                                                                                                
              NodeID: oItems[i].NodeId,                                                                                                                                                                                                                        
              ParentNodeID: oItems[i].PnodeId,                                                                                                                                                                                                                 
              remItems: oItems[i],                                                                                                                                                                                                                             
              children: oChild2,                                                                                                                                                                                                                               
            };                                                                                                                                                                                                                                                 
            oHLevel2Table.push({ oListItem2 });                                                                                                                                                                                                                
            break;                                                                                                                                                                                                                                             
            case 3:                                                                                                                                                                                                                                            
            oListItem3 = {                                                                                                                                                                                                                                     
              Description: oItems[i].Aciklama,                                                                                                                                                                                                                 
              Drillstate: oItems[i].Status,                                                                                                                                                                                                                    
              HierarchyLevel: oItems[i].HLevel,                                                                                                                                                                                                                
              NodeID: oItems[i].NodeId,                                                                                                                                                                                                                        
              ParentNodeID: oItems[i].PnodeId,                                                                                                                                                                                                                 
              remItems: oItems[i],                                                                                                                                                                                                                             
              children: oChild3,                                                                                                                                                                                                                               
            };                                                                                                                                                                                                                                                 
            oHLevel3Table.push({ oListItem3 });                                                                                                                                                                                                                
            break;                                                                                                                                                                                                                                             
          }                                                                                                                                                                                                                                                    
          }                                                                                                                                                                                                                                                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
          var children0 = [];                                                                                                                                                                                                                                  
          var children1 = [];                                                                                                                                                                                                                                  
          var children2 = [];                                                                                                                                                                                                                                  
          var child0 = [];                                                                                                                                                                                                                                     
          var child1 = [];                                                                                                                                                                                                                                     
          var child2 = [];                                                                                                                                                                                                                                     
          var child3 = [];                                                                                                                                                                                                                                     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
          for (var i = 0; i < oHLevel0Table.length; i++) {                                                                                                                                                                                                     
          children2 = [];                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
          for (var j = 0; j < oHLevel1Table.length; j++) {                                                                                                                                                                                                     
            if (                                                                                                                                                                                                                                               
            oHLevel0Table[i].oListItem0.NodeID ===                                                                                                                                                                                                             
            oHLevel1Table[j].oListItem1.ParentNodeID                                                                                                                                                                                                           
            ) {                                                                                                                                                                                                                                                
            children1 = [];                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
            for (var k = 0; k < oHLevel2Table.length; k++) {                                                                                                                                                                                                   
              if (                                                                                                                                                                                                                                             
              oHLevel1Table[j].oListItem1.NodeID ===                                                                                                                                                                                                           
              oHLevel2Table[k].oListItem2.ParentNodeID                                                                                                                                                                                                         
              ) {                                                                                                                                                                                                                                              
              children0 = [];                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
              for (var l = 0; l < oHLevel3Table.length; l++) {                                                                                                                                                                                                 
                if (                                                                                                                                                                                                                                           
                oHLevel2Table[k].oListItem2.NodeID ===                                                                                                                                                                                                         
                oHLevel3Table[l].oListItem3.ParentNodeID                                                                                                                                                                                                       
                ) {                                                                                                                                                                                                                                            
                child0 = {                                                                                                                                                                                                                                     
                  Description:                                                                                                                                                                                                                                 
                  oHLevel3Table[l].oListItem3.Description,                                                                                                                                                                                                     
                  Drillstate:                                                                                                                                                                                                                                  
                  oHLevel3Table[l].oListItem3.Drillstate,                                                                                                                                                                                                      
                  HierarchyLevel:                                                                                                                                                                                                                              
                  oHLevel3Table[l].oListItem3.HierarchyLevel,                                                                                                                                                                                                  
                  NodeID: oHLevel3Table[l].oListItem3.NodeID,                                                                                                                                                                                                  
                  ParentNodeID:                                                                                                                                                                                                                                
                  oHLevel3Table[l].oListItem3.ParentNodeID,                                                                                                                                                                                                    
                  remItems: oHLevel3Table[l].oListItem3,                                                                                                                                                                                                       
                };                                                                                                                                                                                                                                             
                // oHLevel2Table[k].oListItem2.children.push(oHLevel3Table[l]);                                                                                                                                                                                
                children0.push(child0);                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
              }                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
              child1 = {                                                                                                                                                                                                                                       
                Description: oHLevel2Table[k].oListItem2.Description,                                                                                                                                                                                          
                Drillstate: oHLevel2Table[k].oListItem2.Drillstate,                                                                                                                                                                                            
                HierarchyLevel:                                                                                                                                                                                                                                
                oHLevel2Table[k].oListItem2.HierarchyLevel,                                                                                                                                                                                                    
                NodeID: oHLevel2Table[k].oListItem2.NodeID,                                                                                                                                                                                                    
                ParentNodeID:                                                                                                                                                                                                                                  
                oHLevel2Table[k].oListItem2.ParentNodeID,                                                                                                                                                                                                      
                remItems: oHLevel2Table[k].oListItem2,                                                                                                                                                                                                         
                children: children0,                                                                                                                                                                                                                           
              };                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
              children1.push(child1);                                                                                                                                                                                                                          
              }                                                                                                                                                                                                                                                
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            child2 = {                                                                                                                                                                                                                                         
              Description: oHLevel1Table[j].oListItem1.Description,                                                                                                                                                                                            
              Drillstate: oHLevel1Table[j].oListItem1.Drillstate,                                                                                                                                                                                              
              HierarchyLevel:                                                                                                                                                                                                                                  
              oHLevel1Table[j].oListItem1.HierarchyLevel,                                                                                                                                                                                                      
              NodeID: oHLevel1Table[j].oListItem1.NodeID,                                                                                                                                                                                                      
              ParentNodeID: oHLevel1Table[j].oListItem1.ParentNodeID,                                                                                                                                                                                          
              remItems: oHLevel1Table[j].oListItem1,                                                                                                                                                                                                           
              children: children1,                                                                                                                                                                                                                             
            };                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            children2.push(child2);                                                                                                                                                                                                                            
            }                                                                                                                                                                                                                                                  
          }                                                                                                                                                                                                                                                    
          child3 = {                                                                                                                                                                                                                                           
            Description: oHLevel0Table[i].oListItem0.Description,                                                                                                                                                                                              
            Drillstate: oHLevel0Table[i].oListItem0.Drillstate,                                                                                                                                                                                                
            HierarchyLevel: oHLevel0Table[i].oListItem0.HierarchyLevel,                                                                                                                                                                                        
            NodeID: oHLevel0Table[i].oListItem0.NodeID,                                                                                                                                                                                                        
            ParentNodeID: oHLevel0Table[i].oListItem0.ParentNodeID,                                                                                                                                                                                            
            remItems: oHLevel0Table[i].oListItem0,                                                                                                                                                                                                             
            children: children2,                                                                                                                                                                                                                               
          };                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
          mainTable.push(child3);                                                                                                                                                                                                                              
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                     
          }                                                                                                                                                                                                                                                    
          // var that = this;                                                                                                                                                                                                                                  
          // var oModel_tree = new JSONModel();                                                                                                                                                                                                                
          //     oModel_tree.setData(mainTable);                                                                                                                                                                                                               
          //     that.getView().setModel(oModel_tree, "oModel_tree");                                                                                                                                                                                          
          //     that.getView().getModel("oModel_tree").refresh();                                                                                                                                                                                             
          //   },                                                                                                                                                                                                                                              
          // });                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
          var oModel_tree = new JSONModel();                                                                                                                                                                                                                   
          oModel_tree.setData(mainTable);                                                                                                                                                                                                                      
          this.getView().setModel(oModel_tree, "oModel_tree");                                                                                                                                                                                                 
          this.getView().getModel("oModel_tree").refresh();                                                                                                                                                                                                    
          this.getView().setBusy(false);&nbsp;                                                                                                                                                                                                                 
        }.bind(this),                                                                                                                                                                                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
      });                                                                                                                                                                                                                                                      
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
      },                                                                                                                                                                                                                                                       
      _onRouteMatched: function(oEvent) {                                                                                                                                                                                                                      
        var oArgs,                                                                                                                                                                                                                                             
        oArgs = oEvent.getParameter("arguments");                                                                                                                                                                                                              
        // Gnderilen parametreyi burada alabilirsiniz                                                                                                                                                                                                        
        var param = oArgs.param;                                                                                                                                                                                                                               
        if (param) {                                                                                                                                                                                                                                           
          var iCurrent = this.getView().getModel("AddBasket").getProperty("/sepet/sepet").length;                                                                                                                                                              
          if (iCurrent > 0) {                                                                                                                                                                                                                                  
            this.oButton.getBadgeCustomData().setValue(iCurrent);                                                                                                                                                                                              
          }else{                                                                                                                                                                                                                                               
            this.oButton.getBadgeCustomData().setValue("");                                                                                                                                                                                                    
          }                                                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        // Alnan parametreyi kullanmak iin gerekli ilemleri yapabilirsiniz                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
    },                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      //! Formatter' kullanarak para birimini biimleme ilevi                                                                                                                                                                                             
      formatCurrency: function(amount) {                                                                                                                                                                                                                       
        return formatter.formatCurrency(amount);                                                                                                                                                                                                               
    },                                                                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
    onSearchProduct: function(oEvent) {                                                                                                                                                                                                                        
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                 
      var searchValue = oEvent.getParameter("query");                                                                                                                                                                                                          
      if (searchValue.length > 3) {                                                                                                                                                                                                                            
        // Encode the search value to handle spaces and special characters                                                                                                                                                                                     
        var encodedSearchValue = encodeURIComponent(searchValue);                                                                                                                                                                                              
&nbsp;&nbsp;                                                                                                                                                                                                                                                   
      var search = true;                                                                                                                                                                                                                                       
      this.getView().setBusy(true);                                                                                                                                                                                                                            
      this.getOwnerComponent()                                                                                                                                                                                                                                 
                  .getModel()                                                                                                                                                                                                                                  
                  // .read("/refTreeSet('" + encodedSearchValue + "')/tree_to_urunler", {                                                                                                                                                                      
                    .read("/refTreeSet(Ref='" + encodedSearchValue + "',Search='" + search + "')/tree_to_urunler",{                                                                                                                                            
                    success: function (oData2) {                                                                                                                                                                                                               
                      this.getView().setBusy(true);                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                               
                      var oItems2 = oData2.results;                                                                                                                                                                                                            
                      oModelTreeProducts = oItems2;                                                                                                                                                                                                            
                      this.getOwnerComponent()                                                                                                                                                                                                                 
                      .getModel("TreeProductSet")                                                                                                                                                                                                              
                      .setProperty("/tree", {                                                                                                                                                                                                                  
                        tree: oModelTreeProducts,                                                                                                                                                                                                              
                      });                                                                                                                                                                                                                                      
                      this.getView().setBusy(false);                                                                                                                                                                                                           
                  }.bind(this),                                                                                                                                                                                                                                
                    error: function (oError) {                                                                                                                                                                                                                 
                    MessageBox.error("Error occurred: " + oError.responseText);                                                                                                                                                                                
                      this.getView().setBusy(false);                                                                                                                                                                                                           
                    },                                                                                                                                                                                                                                         
                  }) };                                                                                                                                                                                                                                        
                  this.getView().setBusy(false);                                                                                                                                                                                                               
    },                                                                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
    liveChangeProduct: function() {                                                                                                                                                                                                                            
      var searchValue = this.getView().byId("searchField").getValue();                                                                                                                                                                                         
&nbsp;                                                                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                             
&nbsp;&nbsp;                                                                                                                                                                                                                                                   
      if (searchValue.length > 2) {                                                                                                                                                                                                                            
          // Encode the search value to handle spaces and special characters                                                                                                                                                                                   
          var encodedSearchValue = encodeURIComponent(searchValue);                                                                                                                                                                                            
          var search = true;                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            // Mevcut istei iptal et                                                                                                                                                                                                                         
            if (this._oCurrentRequest) {                                                                                                                                                                                                                       
              this._oCurrentRequest.abort();                                                                                                                                                                                                                   
          }                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
      this.getView().setBusy(true);                                                                                                                                                                                                                            
      this._oCurrentRequest = this.getOwnerComponent()                                                                                                                                                                                                         
                  .getModel()                                                                                                                                                                                                                                  
                  .read("/refTreeSet(Ref='" + encodedSearchValue + "',Search='" + search + "')/tree_to_urunler", {                                                                                                                                             
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                     
                    success: function (oData2) {                                                                                                                                                                                                               
                      this.getView().setBusy(true);                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                           
                      var oItems2 = oData2.results;                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                           
                      oModelTreeProducts = oItems2;                                                                                                                                                                                                            
                      this.getOwnerComponent()                                                                                                                                                                                                                 
                      .getModel("TreeProductSet")                                                                                                                                                                                                              
                      .setProperty("/tree", {                                                                                                                                                                                                                  
                        tree: oModelTreeProducts,                                                                                                                                                                                                              
                      });                                                                                                                                                                                                                                      
                      this.getView().setBusy(false);                                                                                                                                                                                                           
                  }.bind(this),                                                                                                                                                                                                                                
                    error: function (oError) {                                                                                                                                                                                                                 
                      // MessageBox.error("Error occurred: " + oError.responseText);                                                                                                                                                                           
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                 
                      this.getView().setBusy(false);                                                                                                                                                                                                           
                    }.bind(this),                                                                                                                                                                                                                              
                  })                                                                                                                                                                                                                                           
                }else {                                                                                                                                                                                                                                        
                  if (this._oCurrentRequest) {                                                                                                                                                                                                                 
                      this._oCurrentRequest.abort();                                                                                                                                                                                                           
                  };                                                                                                                                                                                                                                           
                  this.getView().setBusy(false);                                                                                                                                                                                                               
    }},                                                                                                                                                                                                                                                        
      //! Add selected items to the basket                                                                                                                                                                                                                     
      addToBasket: function (oEvent) {                                                                                                                                                                                                                         
        this.getView().setBusy(true);                                                                                                                                                                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                 
        var oButton = oEvent.getSource();                                                                                                                                                                                                                      
        oButton.setEnabled(false);                                                                                                                                                                                                                             
        // idAddToChart                                                                                                                                                                                                                                        
        let selectedItem = oEvent.getSource().getParent().getParent().getBindingContext("BagliProductSet").getObject();                                                                                                                                        
        var oModelBasket = this.getOwnerComponent().getModel("AddBasket");                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        // var sepeto = oModelBasket.getProperty("/sepet/sepet");                                                                                                                                                                                              
        let aBasket = oModelBasket.getProperty("/sepet/sepet");                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
        // read msg from i18n model                                                                                                                                                                                                                            
        const oBundle = this.getView().getModel("i18n").getResourceBundle();                                                                                                                                                                                   
        var sMessage;&nbsp;                                                                                                                                                                                                                                    
        //! selectedItem.Matnr                                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                   
            if (selectedItem) {                                                                                                                                                                                                                                
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                 
              if (selectedItem.count === 1){                                                                                                                                                                                                                   
              selectedItem.toplamKDV = selectedItem.Kdv;                                                                                                                                                                                                       
              selectedItem.tutar = selectedItem.Tutar;                                                                                                                                                                                                         
              selectedItem.tutar = selectedItem.Tutar2;                                                                                                                                                                                                        
              selectedItem.tutar = selectedItem.BirimToplamTutar;                                                                                                                                                                                              
              selectedItem.toplamKDVsizFiyat = selectedItem.Price;                                                                                                                                                                                             
              selectedItem.id = Math.floor(Math.random() * 100000000000000);                                                                                                                                                                                   
            }else{                                                                                                                                                                                                                                             
              selectedItem.id = Math.floor(Math.random() * 100000000000000);                                                                                                                                                                                   
            }}                                                                                                                                                                                                                                                 
            // var oModelBasket = this.getOwnerComponent().getModel("AddBasket");                                                                                                                                                                              
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            // var lv_metacode = selectedItem.metacode;                                                                                                                                                                                                        
            // var lv_matnr = selectedItem.Matnr;                                                                                                                                                                                                              
            // selectedItem.metacode = lv_matnr;                                                                                                                                                                                                               
            // selectedItem.Matnr = lv_metacode;                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            aBasket.push(selectedItem);                                                                                                                                                                                                                        
            oModelBasket.setProperty("/basket", aBasket);                                                                                                                                                                                                      
            oModelBasket.setProperty("/sepet/sepet", aBasket);                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            iCurrent = oModelBasket.getProperty("/basket").length;                                                                                                                                                                                             
            this.getOwnerComponent().getModel("AddBasket").setProperty("/sepetLength",iCurrent );                                                                                                                                                              
            this.getView().setBusy(false);                                                                                                                                                                                                                     
            setTimeout(function() {                                                                                                                                                                                                                            
              oButton.setEnabled(true); // Butonu tekrar etkinletir                                                                                                                                                                                          
          }, 1300); // 1 saniye (1000 milisaniye) bekler                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
          if (iCurrent>0) {                                                                                                                                                                                                                                    
            this.oButton.getBadgeCustomData().setValue(iCurrent);                                                                                                                                                                                              
            // var sMessage = "rnleriniz Basariyla Sepete Eklendi."; // Success message {i18n>addingSuccess}&nbsp;                                                                                                                                         
            sMessage = oBundle.getText("addingSuccess"); // Success message {i18n>addingSuccess}&nbsp;                                                                                                                                                         
            // Clear the search field                                                                                                                                                                                                                          
            this.getView().byId("searchField").setValue("");                                                                                                                                                                                                   
          sap.m.MessageToast.show(sMessage);                                                                                                                                                                                                                   
          this.onCloseButtonPress();                                                                                                                                                                                                                           
        } else {                                                                                                                                                                                                                                               
          sMessage = oBundle.getText("selectProduct");                                                                                                                                                                                                         
          sap.m.MessageToast.show(sMessage);                                                                                                                                                                                                                   
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        this.getView().setBusy(false);                                                                                                                                                                                                                         
      },                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      //!  fragment ve rn infosu tiklandiginda pop up acma                                                                                                                                                                                                 
      onColumnListItemPress: function (oEvent) {                                                                                                                                                                                                               
&nbsp;&nbsp;                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
        var oTreeTable = this.getView().byId("idProductCollectionTable");                                                                                                                                                                                      
        var oTreeTable2 = this.getView().byId("treeTable");                                                                                                                                                                                                    
        var oMasterButtonParent = this.getView().byId("idPage");                                                                                                                                                                                               
        var oMasterButton =oMasterButtonParent.getEventingParent()._mFocusObject;                                                                                                                                                                              
                                                                                                                                                                                                                                                               
        var oModel2 = this.getOwnerComponent().getModel();                                                                                                                                                                                                     
        bagliProductMatnr = oEvent.oSource.mAggregations.cells[1].mProperties.text;                                                                                                                                                                            
        var regex = /\(([^)]+)\)/; // Parantezler iindeki herhangi bir eyi eletirir                                                                                                                                                                    
        var match = bagliProductMatnr.match(regex);                                                                                                                                                                                                            
        var matnr = match ? match[1] : null;                                                                                                                                                                                                                   
        // bagliProductMatnr =  bagliProductMatnr.replace(/\([^)]*\)/, '');                                                                                                                                                                                    
        this.getView().setBusy(true);                                                                                                                                                                                                                          
        // /sap/opu/odata/SAP/ZSD_ODATA_KASA_SRV/HeaderBagliUrunlerSet('35000066176')/HeaderToItemNav                                                                                                                                                          
        oModel2.read("/HeaderBagliUrunlerSet('" + matnr + "')/HeaderToItemNav",                                                                                                                                                                                
          {                                                                                                                                                                                                                                                    
            success: function (oData, oResponse) {                                                                                                                                                                                                             
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
              oBagliProductList = oData.results;                                                                                                                                                                                                               
              oBagliProductList.forEach(function(item) {                                                                                                                                                                                                       
                // Her bir enin iine "tutar" adnda bir zellik ekleyelim ve bu zellii "price" zellii ile eleyelim                                                                                                                           
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                           
                item.tutar = item.Tutar;&nbsp;                                                                                                                                                                                                                 
                item.Tutar2 = item.Tutar;&nbsp;                                                                                                                                                                                                                
                item.BirimToplamTutar = item.Tutar;&nbsp;                                                                                                                                                                                                      
                item.count = 1; // Varsaylan olarak "count" 1 olarak ayarlayalm                                                                                                                                                                          
              });                                                                                                                                                                                                                                              
              // this.getView().setBusy(false);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
              this.getOwnerComponent()                                                                                                                                                                                                                         
                .getModel("BagliProductSet")                                                                                                                                                                                                                   
                .setProperty("/", {                                                                                                                                                                                                                            
                  bagli: oBagliProductList,                                                                                                                                                                                                                    
                });                                                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                     
              // Rufe die Funktion zum Laden des Fragments auf                                                                                                                                                                                                 
              this.fragmentLaden();                                                                                                                                                                                                                            
              // Setze den Ladezustand zurck                                                                                                                                                                                                                 
              this.getView().setBusy(false);                                                                                                                                                                                                                   
              // this.getView().setBusy(false);                                                                                                                                                                                                                
            }.bind(this),                                                                                                                                                                                                                                      
            error: function (oError) {                                                                                                                                                                                                                         
              MessageBox.error("Error occurred: " + oError.responseText);                                                                                                                                                                                      
              this.getView().setBusy(false);                                                                                                                                                                                                                   
            }.bind(this),                                                                                                                                                                                                                                      
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
          }                                                                                                                                                                                                                                                    
        );                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                             
      },                                                                                                                                                                                                                                                       
      fragmentLaden: async function () {                                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                           
        // create dialog lazily                                                                                                                                                                                                                                
        this.oDialog ??= await this.loadFragment({                                                                                                                                                                                                             
          name: "test.fragments.product",                                                                                                                                                                                                                      
        });                                                                                                                                                                                                                                                    
        var oGlobalJSONModel = this.getView().getModel("BagliProductSet");                                                                                                                                                                                     
        this.oDialog.setModel(oGlobalJSONModel, "BagliProductSet");                                                                                                                                                                                            
        this.oDialog.bindElement({                                                                                                                                                                                                                             
          path: "/",                                                                                                                                                                                                                                           
        });                                                                                                                                                                                                                                                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                     
        this.getView().byId('CurrentValue').setValue("");                                                                                                                                                                                                      
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                           
        this.oDialog.open();                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
      },                                                                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      onCloseButtonPress: function () {                                                                                                                                                                                                                        
        this.getView().byId("tab1").removeSelections();                                                                                                                                                                                                        
        this.oDialog.close();                                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                             
        // todo selected indicesi sifirla                                                                                                                                                                                                                      
      },                                                                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
      onClearBasket: function () {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
        // read msg from i18n model                                                                                                                                                                                                                            
        const oBundle = this.getView().getModel("i18n").getResourceBundle();                                                                                                                                                                                   
        var sMessage= oBundle.getText("messageText2");                                                                                                                                                                                                         
        var oModelSepet = this.getOwnerComponent().getModel("AddBasket");                                                                                                                                                                                      
        oModelSepet.setProperty("/sepet/sepet", []);                                                                                                                                                                                                           
        oModelSepet.setProperty("/customerInfo", {});                                                                                                                                                                                                          
        oModelSepet.setProperty("/salesmanInfo", {});                                                                                                                                                                                                          
        // oModelSepet.setProperty("/basket", []);                                                                                                                                                                                                             
        oModelSepet.setProperty("/inputsVisible", false);                                                                                                                                                                                                      
        oModelSepet.setProperty("/step0", false);                                                                                                                                                                                                              
        oModelSepet.setProperty("/step1", false);                                                                                                                                                                                                              
        oModelSepet.setProperty("/step2", false);                                                                                                                                                                                                              
        oModelSepet.setProperty("/step3", false);                                                                                                                                                                                                              
        oModelSepet.setProperty("/updateEnable", false);                                                                                                                                                                                                       
        oModelSepet.setProperty("/createEnable", false);                                                                                                                                                                                                       
        this.oButton.getBadgeCustomData().setValue("");                                                                                                                                                                                                        
    // var sMessage = "Aliseris Sepeti Temizlendi";                                                                                                                                                                                                            
    MessageToast.show(sMessage);                                                                                                                                                                                                                               
    setTimeout(() => {                                                                                                                                                                                                                                         
      this.getOwnerComponent().getRouter().navTo("RouteView0");                                                                                                                                                                                                
    }, 1000);                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      },                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      onGoView0: function () {                                                                                                                                                                                                                                 
        this.onClearBasket();                                                                                                                                                                                                                                  
    this.oButton.getBadgeCustomData().setValue("");                                                                                                                                                                                                            
    this.getOwnerComponent().getRouter().navTo("RouteView0");                                                                                                                                                                                                  
&nbsp;                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      },                                                                                                                                                                                                                                                       
      onBadgedButtonPress: function () {                                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
        // var oModelBasket = this.getOwnerComponent().getModel("AddBasket");                                                                                                                                                                                  
        let aBasket =this.getView().getModel("AddBasket").getProperty("/sepet/sepet");                                                                                                                                                                         
                                                                                                                                                                                                                                                               
        // if (aBasket) {                                                                                                                                                                                                                                      
        //   aBasket.forEach(function (item) {                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                 
        //     item.DiscountedTutar = item.tutar;                                                                                                                                                                                                              
        //     item.BirimDiscountedTutar = item.Tutar;                                                                                                                                                                                                         
        //   });                                                                                                                                                                                                                                               
        // }&nbsp;                                                                                                                                                                                                                                             
        // var sepetData = this.getOwnerComponent().getModel("AddBasket").oData.sepet.sepet;                                                                                                                                                                   
        var sepetUrunCesidSayisi = aBasket.length;                                                                                                                                                                                                             
        var newSepetData = aBasket.map(item => ({...item}));                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
        if (newSepetData) {                                                                                                                                                                                                                                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
var productsTotalPrice = newSepetData.reduce((acc, item) => (parseFloat(acc) + parseFloat(item.tutar)).toString(), '0');                                                                                                                                       
var totalPriceWithoutVAT = newSepetData.reduce((acc, item) => (parseFloat(acc) + parseFloat(item.toplamKDVsizFiyat)).toString(), '0');                                                                                                                         
var productsTotalVAT = newSepetData.reduce((acc, item) => (parseFloat(acc) + parseFloat(item.toplamKDV)).toString(), '0');                                                                                                                                     
                                                                                                                                                                                                                                                               
          this.getOwnerComponent().getModel("AddBasket").setProperty("/ProductsTotalPrice", productsTotalPrice);                                                                                                                                               
          this.getOwnerComponent().getModel("AddBasket").setProperty("/TotalPriceWithoutVAT", totalPriceWithoutVAT);                                                                                                                                           
          this.getOwnerComponent().getModel("AddBasket").setProperty("/ProductsTotalVAT", productsTotalVAT);                                                                                                                                                   
          this.getOwnerComponent().getModel("AddBasket").setProperty("/ProductsArtNumber", sepetUrunCesidSayisi);                                                                                                                                              
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                   
      } else {                                                                                                                                                                                                                                                 
          oModelSepet.setProperty("/ProductsTotalPrice", 0);                                                                                                                                                                                                   
      }                                                                                                                                                                                                                                                        
      if (aBasket.length > 0) {                                                                                                                                                                                                                                
        // this.getOwnerComponent().getRouter().navTo("RouteView4", {}, true);                                                                                                                                                                                 
        setTimeout(() => {                                                                                                                                                                                                                                     
          this.getOwnerComponent().getRouter().navTo("RouteView4",{                                                                                                                                                                                            
                  param: "test"                                                                                                                                                                                                                                
              });                                                                                                                                                                                                                                              
        }, 200);                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      }                                                                                                                                                                                                                                                        
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      },                                                                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
&nbsp;                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
      toggleOpenState: function (oEvent) {                                                                                                                                                                                                                     
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
      },                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      onRowSelectionChange: function (oEvent) {                                                                                                                                                                                                                
&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
        var clickedPath = oEvent.getParameters().rowBindingContext.sPath;                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        var oTreeTable = this.getView().byId("treeTablePage");                                                                                                                                                                                                 
        // oTreeTable.collapse(true);                                                                                                                                                                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
        // var oTreeTable = this.byId("treeTable");                                                                                                                                                                                                            
        // var iRowIndex = oTreeTable.getSelectedIndex();                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        var edittedPathArray = clickedPath.split("/");                                                                                                                                                                                                         
        if (edittedPathArray.length > 3) {                                                                                                                                                                                                                     
          var newArray = [];                                                                                                                                                                                                                                   
          for (var i = 0; i < edittedPathArray.length; i++) {                                                                                                                                                                                                  
            if (                                                                                                                                                                                                                                               
              edittedPathArray[i] != "children" &&                                                                                                                                                                                                             
              edittedPathArray[i] != ""                                                                                                                                                                                                                        
            ) {                                                                                                                                                                                                                                                
              newArray.push(edittedPathArray[i]);                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
          }                                                                                                                                                                                                                                                    
&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
          if (oEvent.getParameters().rowBindingContext.oModel.oData[newArray[0]]) {                                                                                                                                                                            
            var aciklama =                                                                                                                                                                                                                                     
                oEvent.getParameters().rowBindingContext.oModel.oData[newArray[0]]                                                                                                                                                                             
                    .children[newArray[1]].children[newArray[2]].children[newArray[3]]                                                                                                                                                                         
                    .Description;                                                                                                                                                                                                                              
        }                                                                                                                                                                                                                                                      
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
              if (aciklama !== undefined) {                                                                                                                                                                                                                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                           
                var selectedDatas = [];                                                                                                                                                                                                                        
                for (var i = 0; i < totalList.length; i++) {                                                                                                                                                                                                   
                  if (totalList[i].Aciklama === aciklama) {                                                                                                                                                                                                    
                    selectedDatas.push(totalList[i]);                                                                                                                                                                                                          
                  }                                                                                                                                                                                                                                            
                }                                                                                                                                                                                                                                              
                var search = false;                                                                                                                                                                                                                            
                var selectedProduct = selectedDatas[0].RefTree;                                                                                                                                                                                                
                this.getView().setBusy(true);                                                                                                                                                                                                                  
                this.getOwnerComponent()                                                                                                                                                                                                                       
                  .getModel()                                                                                                                                                                                                                                  
                    .read("/refTreeSet(Ref='" + selectedProduct + "',Search='" + search + "')/tree_to_urunler", {                                                                                                                                              
                    success: function (oData2) {                                                                                                                                                                                                               
                      var oItems2 = oData2.results;                                                                                                                                                                                                            
                      oModelTreeProducts = oItems2;                                                                                                                                                                                                            
                      this.getOwnerComponent()                                                                                                                                                                                                                 
                      .getModel("TreeProductSet")                                                                                                                                                                                                              
                      .setProperty("/tree", {                                                                                                                                                                                                                  
                        tree: oModelTreeProducts,                                                                                                                                                                                                              
                      });                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                      this.getView().setBusy(false);                                                                                                                                                                                                           
                  }.bind(this),                                                                                                                                                                                                                                
                    error: function (oError) {                                                                                                                                                                                                                 
                      MessageBox.error("Error occurred: " + oError.responseText);                                                                                                                                                                              
                      this.getView().setBusy(false);                                                                                                                                                                                                           
                    },                                                                                                                                                                                                                                         
                  });                                                                                                                                                                                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                           
              }                                                                                                                                                                                                                                                
            }                                                                                                                                                                                                                                                  
          },                                                                                                                                                                                                                                                   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                 
      onScanSuccess: function (oEvent) {                                                                                                                                                                                                                       
        if (oEvent.getParameter("cancelled")) {                                                                                                                                                                                                                
          MessageToast.show("Scan cancelled", { duration: 1000 });                                                                                                                                                                                             
        } else {                                                                                                                                                                                                                                               
          if (oEvent.getParameter("text")) {                                                                                                                                                                                                                   
            // todo texti odataya bagla rn al                                                                                                                                                                                                            
            var scanId = oEvent.getParameter("text")                                                                                                                                                                                                           
            // this.getView().setBusy(true);                                                                                                                                                                                                                   
            this.getOwnerComponent()                                                                                                                                                                                                                           
            .getModel()                                                                                                                                                                                                                                        
            .read("/BarkodUrunSet('" + scanId + "')", {                                                                                                                                                                                                        
              success: function (oData2) {                                                                                                                                                                                                                     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                           
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                     
                // oBagliProductList = oData2;                                                                                                                                                                                                                 
                oBagliProductList = Array.isArray(oData2) ? oData2 : [oData2];                                                                                                                                                                                 
                oBagliProductList.forEach(function(item) {                                                                                                                                                                                                     
                  // Her bir enin iine "tutar" adnda bir zellik ekleyelim ve bu zellii "price" zellii ile eleyelim                                                                                                                         
                  item.tutar = item.Tutar;&nbsp;                                                                                                                                                                                                               
                  // item.tutar = "500";&nbsp;                                                                                                                                                                                                                 
                  item.Tutar2 = item.Tutar;&nbsp;                                                                                                                                                                                                              
                  // item.Tutar2 = "500";&nbsp;                                                                                                                                                                                                                
                  item.BirimToplamTutar = item.Tutar;&nbsp;                                                                                                                                                                                                    
                  // item.BirimToplamTutar = "500";&nbsp;                                                                                                                                                                                                      
                  item.count = 1; // Varsaylan olarak "count" 1 olarak ayarlayalm                                                                                                                                                                        
                });                                                                                                                                                                                                                                            
                // this.getView().setBusy(false);                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                     
                this.getOwnerComponent()                                                                                                                                                                                                                       
                .getModel("BagliProductSet")                                                                                                                                                                                                                   
                .setProperty("/", {                                                                                                                                                                                                                            
                  bagli: oBagliProductList,                                                                                                                                                                                                                    
                });                                                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                               
              // Rufe die Funktion zum Laden des Fragments auf                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
              this.fragmentLaden();                                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            }.bind(this),                                                                                                                                                                                                                                      
              error: function (error) {                                                                                                                                                                                                                        
                MessageBox.error("Error occurred: " + error.responseText);                                                                                                                                                                                     
              },                                                                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
          } else {                                                                                                                                                                                                                                             
            oScanResultText.setText("");                                                                                                                                                                                                                       
            this.getView().setBusy(false);                                                                                                                                                                                                                     
          }                                                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
      },                                                                                                                                                                                                                                                       
      onScanError: function (oEvent) {                                                                                                                                                                                                                         
        MessageToast.show("Scan failed: " + oEvent, { duration: 1000 });                                                                                                                                                                                       
        this.getView().setBusy(false);                                                                                                                                                                                                                         
      },                                                                                                                                                                                                                                                       
      onScanLiveupdate: function (oEvent) {                                                                                                                                                                                                                    
        // User can implement the validation about inputting value                                                                                                                                                                                             
      },                                                                                                                                                                                                                                                       
      currentChangeHandler: function (oEvent) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
        adet = oEvent.mParameters.value                                                                                                                                                                                                                        
        // Retrieve the value of "idBagliTutar" from the view                                                                                                                                                                                                  
        var oModel = this.getView().getModel("BagliProductSet");                                                                                                                                                                                               
        var fPrice = oModel.getProperty(oEvent.getSource().getBindingContext("BagliProductSet").getPath() + "/Tutar");                                                                                                                                         
        var sPath = oEvent.getSource().getBindingContext("BagliProductSet").getPath();                                                                                                                                                                         
        var fResult = adet * parseFloat(fPrice);                                                                                                                                                                                                               
        var formattedResult = fResult.toFixed(3);                                                                                                                                                                                                              
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        var fKDV = oModel.getProperty(oEvent.getSource().getBindingContext("BagliProductSet").getPath() + "/Kdv");                                                                                                                                             
        var fKDVResult = adet * parseFloat(fKDV);                                                                                                                                                                                                              
        var formattedKDVResult = fKDVResult.toFixed(3);                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
        var fToplamKDVsiz = oModel.getProperty(oEvent.getSource().getBindingContext("BagliProductSet").getPath() + "/Price");                                                                                                                                  
        var fKDVsizTopResult = adet * parseFloat(fToplamKDVsiz);                                                                                                                                                                                               
        var formattedKDVsizTopResult = fKDVsizTopResult.toFixed(3);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                             
        oModel.setProperty(sPath + "/tutar", formattedResult);                                                                                                                                                                                                 
        oModel.setProperty(sPath + "/Tutar2", formattedResult);                                                                                                                                                                                                
        oModel.setProperty(sPath + "/BirimToplamTutar", formattedResult);                                                                                                                                                                                      
        oModel.setProperty(sPath + "/toplamKDV", formattedKDVResult);                                                                                                                                                                                          
        oModel.setProperty(sPath + "/toplamKDVsizFiyat", formattedKDVsizTopResult);                                                                                                                                                                            
        oModel.setProperty(sPath + "/count", adet);                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        // var changingProductMatnr = oEvent.getSource().getParent().mAggregations.cells[2].getProperty("text")                                                                                                                                                
      //   if (selectedData) {                                                                                                                                                                                                                                 
      //     for (var i = 0; i < selectedData.length; i++) {                                                                                                                                                                                                   
      //         if (selectedData[i].selectedMatnr === changingProductMatnr) {                                                                                                                                                                                 
      //             selectedData[i].selectedrnMiktar = oEvent.mParameters.value;                                                                                                                                                                          
      //             break; // Once the product is found and updated, exit the loop                                                                                                                                                                            
      //         }                                                                                                                                                                                                                                             
      //     }                                                                                                                                                                                                                                                 
      // }                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
      // this.getOwnerComponent().getModel("AddBasket").setProperty("/sepet", selectedData);                                                                                                                                                                   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            // }                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      }                                                                                                                                                                                                                                                        
    });                                                                                                                                                                                                                                                        
  }                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
);                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               